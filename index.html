<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Link Direto do Google Drive → Download</title>
  <style>
    :root {
      --bg: #f7f5f1;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #4e9fce; /* paleta do CEMA friendly */
      --accent2: #4f4287;
      --ok: #16a34a;
      --warn: #dc2626;
    }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    body { margin: 0; background: var(--bg); color: var(--text); }
    .wrap { max-width: 880px; margin: 40px auto; padding: 0 20px; }
    .card { background: var(--card); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.08); padding: 28px; }
    h1 { font-weight: 800; letter-spacing: -0.02em; margin: 0 0 8px; }
    p.lead { margin: 0 0 20px; color: var(--muted); }
    label { display:block; font-weight: 600; margin: 18px 0 8px; }
    input[type="url"], input[type="text"], textarea { width: 100%; padding: 14px 16px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; transition: border .15s ease; }
    input[type="url"]:focus, input[type="text"]:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(78,159,206,.15); }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }
    .btn { appearance: none; border: 0; border-radius: 12px; padding: 12px 16px; font-weight: 700; cursor: pointer; background: var(--accent); color: #fff; transition: transform .02s ease, filter .2s ease; }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: var(--accent2); }
    .out { background:#f9fafb; border:1px dashed #d1d5db; border-radius:12px; padding: 14px 16px; word-break: break-all; }
    .muted { color: var(--muted); font-size: 14px; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; }
    .ok { background: #ecfdf5; color: #065f46; }
    .err { background: #fef2f2; color: #991b1b; }
    details { margin-top: 22px; }
    summary { cursor: pointer; font-weight: 700; color: var(--accent2); }
    code { background:#f3f4f6; padding:2px 6px; border-radius:6px; }
    .small { font-size: 12px; }
    .grid-2 { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 720px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Gerador de Link Direto do Google Drive → Download</h1>
      <p class="lead">Cole abaixo o link de <strong>compartilhamento</strong> do Drive (ex.: <code>/file/d/..../view</code> ou <code>?id=</code>) e gere o link pronto para <em>download</em> (<code>uc?export=download&amp;id=...</code>).</p>

      <label for="in">Link de entrada (Google Drive)</label>
      <div class="row">
        <input id="in" type="url" placeholder="https://drive.google.com/file/d/FILE_ID/view?usp=sharing" autocomplete="off" />
        <button class="btn" id="go">Gerar saída</button>
      </div>
      <p class="muted small">Aceita formatos: <code>/file/d/ID/...</code>, <code>/open?id=ID</code>, <code>?id=ID</code>, ou já no formato <code>uc?id=ID</code>. Para pastas, esta ferramenta não se aplica.</p>

      <label for="out" style="margin-top:18px;">Link de saída (pronto para baixar)</label>
      <div class="grid-2">
        <input id="out" type="text" class="out" readonly placeholder="O link convertido aparecerá aqui" />
        <div style="display:flex; gap:10px;">
          <button class="btn secondary" id="copy" title="Copiar para área de transferência">Copiar</button>
          <a class="btn" id="test" href="#" target="_blank" rel="noopener" title="Testar em nova aba">Testar</a>
        </div>
      </div>
      <div id="status" style="margin-top:12px;"></div>

      <details>
        <summary>Instruções: usar no WordPress (JetEngine → Dynamic Field)</summary>
        <div style="margin-top:12px;">
          <ol>
            <li>No seu <strong>Meta Field</strong>, salve <em>este link convertido</em> (o de saída acima).</li>
            <li>No widget <strong>Dynamic Field</strong>, marque <em>Customize field output</em> e use:
              <pre><code>&lt;a href="%s" target="_blank" rel="noopener" download="documento.pdf"&gt;Baixar PDF&lt;/a&gt;</code></pre>
            </li>
            <li>Publicar. Ao clicar, o navegador fará o download do PDF hospedado no Google Drive.</li>
          </ol>
          <p class="muted">Dica: escolha um nome sugestivo em <code>download="documento.pdf"</code>, por exemplo <code>download="regimento-cema.pdf"</code>.</p>
        </div>
      </details>

      <details>
        <summary>Como funciona (para referência)</summary>
        <p class="muted">A página extrai o <em>file ID</em> do link do Drive e gera a URL no formato: <code>https://drive.google.com/uc?export=download&amp;id=FILE_ID</code>. Tudo roda localmente, sem enviar nada a servidores externos.</p>
      </details>
    </div>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);

    function extractDriveId(url) {
      if (typeof url !== 'string') return '';
      url = url.trim();
      if (!url) return '';
      try {
        // Tenta normalizar sem quebrar querystrings
        const u = new URL(url);
        // 1) formatos com ?id=FILEID ou open?id=FILEID
        const qId = u.searchParams.get('id');
        if (qId && /^[a-zA-Z0-9_-]{10,}$/.test(qId)) return qId;
      } catch(_) {
        // URL inválida? ainda dá pra tentar por regex bruto
      }
      // 2) /file/d/FILEID/
      const m1 = url.match(/\/file\/d\/([a-zA-Z0-9_-]{10,})/);
      if (m1) return m1[1];
      // 3) /uc\?id=FILEID ou qualquer id=FILEID em string
      const m2 = url.match(/[?&]id=([a-zA-Z0-9_-]{10,})/);
      if (m2) return m2[1];
      // 4) id "cru" (último recurso: captura um token grande com A-Za-z0-9_-)
      const m3 = url.match(/([a-zA-Z0-9_-]{25,})/);
      if (m3) return m3[1];
      return '';
    }

    function makeDirectLink(fileId) {
      return `https://drive.google.com/uc?export=download&id=${fileId}`;
    }

    function setStatus(ok, msg) {
      const el = $('#status');
      el.innerHTML = '';
      if (!msg) return;
      const pill = document.createElement('span');
      pill.className = `pill ${ok ? 'ok' : 'err'}`;
      pill.textContent = msg;
      el.appendChild(pill);
    }

    function generate() {
      const input = $('#in').value;
      const id = extractDriveId(input);
      if (!id) {
        setStatus(false, 'Não foi possível identificar o ID do arquivo.');
        $('#out').value = '';
        $('#test').setAttribute('href', '#');
        return;
      }
      const out = makeDirectLink(id);
      $('#out').value = out;
      $('#test').setAttribute('href', out);
      setStatus(true, 'Link gerado com sucesso.');
      $('#out').focus();
      $('#out').select();
      try { document.execCommand('copy'); } catch(_) {}
    }

    $('#go').addEventListener('click', generate);
    $('#in').addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); generate(); } });
    $('#copy').addEventListener('click', async () => {
      const v = $('#out').value;
      if (!v) return;
      try { await navigator.clipboard.writeText(v); setStatus(true, 'Copiado para a área de transferência.'); } catch(_) { setStatus(true, 'Copiado (método alternativo).'); }
    });
  </script>
</body>
</html>
